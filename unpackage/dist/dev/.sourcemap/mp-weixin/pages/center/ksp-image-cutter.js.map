{"version":3,"sources":["webpack:///D:/app/xcx/dabangsStar/pages/center/ksp-image-cutter.vue?1dcb","webpack:///D:/app/xcx/dabangsStar/pages/center/ksp-image-cutter.vue?a716","webpack:///D:/app/xcx/dabangsStar/pages/center/ksp-image-cutter.vue?fe13","webpack:///D:/app/xcx/dabangsStar/pages/center/ksp-image-cutter.vue?51ec","uni-app:///pages/center/ksp-image-cutter.vue","webpack:///D:/app/xcx/dabangsStar/pages/center/ksp-image-cutter.vue?014e"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;2DAAA,6UACIA,EADJ,iHASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,oCACZ,aAAAF,E;;;;2GCvBf,y0B;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G;;;;2DCRvB,ifAAm4B,eAAG,G;;;;gJCmCt4B,CACA,OACA,KACA,YACA,YAEA,OACA,aACA,YAEA,OACA,YACA,aAEA,QACA,YACA,aAEA,UACA,YACA,cAEA,WACA,YACA,cAEA,MACA,aACA,aAGA,KA/BA,WAgCA,OACA,MACA,SAEA,OACA,QACA,OACA,iBACA,oBAEA,OACA,QACA,OACA,UACA,YAEA,MACA,UACA,YAEA,QACA,iBACA,oBAEA,WACA,QACA,OACA,OACA,OACA,MACA,QACA,UAEA,OACA,OACA,MACA,QACA,WAGA,aACA,eAGA,QA5EA,WAkFA,kDACA,yDAEA,SACA,UADA,SACA,cACA,kBACA,+BACA,iCACA,gCACA,kCACA,4BACA,8BACA,aACA,kCACA,qCAEA,uCACA,kDACA,cACA,WACA,gBACA,iBACA,OACA,OACA,MACA,MACA,IACA,MACA,KAEA,MACA,MACA,cACA,UACA,gBACA,iBACA,eACA,cAEA,oBACA,iBACA,MACA,MACA,IACA,MACA,KAEA,kBACA,mBACA,iCACA,iCACA,uBACA,gBACA,QACA,QAEA,YArDA,aAsDA,WAtDA,SAsDA,KACA,gBACA,kBACA,yBACA,YACA,sCACA,oCACA,wCACA,0CACA,sCACA,oCACA,wCACA,2CAGA,IADA,uBACA,oBACA,WAEA,uBAGA,UA3EA,SA2EA,GACA,gBACA,mBACA,gBACA,0BACA,mDACA,qCAEA,qDAEA,wCACA,sBACA,kBACA,OACA,OACA,+BACA,QACA,IACA,IAEA,2BAGA,SAlGA,SAkGA,GACA,aACA,gBACA,kBAEA,YAvGA,SAuGA,GACA,aACA,gBACA,kBAEA,UA5GA,WA4GA,WACA,gBACA,sCACA,gBACA,MAEA,SAlHA,WAmHA,oBACA,6BACA,oBAGA,UAxHA,WAwHA,WACA,kBACA,uCACA,kDACA,cACA,WACA,gBACA,iBACA,OACA,OACA,MACA,MACA,IACA,MACA,KAEA,MACA,MACA,cACA,UACA,mDACA,gDACA,gBACA,iBACA,eACA,cACA,iBACA,kBACA,gBACA,kBACA,OACA,uBACA,iCACA,gCACA,8BACA,kBACA,mBACA,oEACA,qBACA,MAEA,UAjKA,SAiKA,KACA,0BACA,sBACA,wCACA,sCACA,kCACA,iCAEA,gCACA,+BAEA,oEACA,mEAEA,oEACA,oEAGA,WAnLA,SAmLA,SACA,gBACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,qCACA,qCACA,UACA,UACA,UACA,UACA,MACA,MACA,MACA,4CACA,2CAEA,8CACA,6CAEA,4CACA,2CAEA,wEACA,qEACA,0CACA,4CACA,kCACA,iCAEA,gCACA,+BAEA,oEACA,mEAEA,oEACA,oEAIA,WAhOA,SAgOA,OACA,0BACA,sBACA,wBACA,uBACA,+CACA,+CACA,UACA,KACA,WACA,KACA,SACA,KACA,YACA,KACA,eACA,KACA,MACA,kBACA,KACA,MACA,gBACA,KACA,MACA,oBACA,KACA,MAEA,oBACA,mBAEA,mBACA,kBAEA,qCACA,oCAEA,qCACA,oCAEA,kBACA,iBACA,qBACA,uBAEA,UA7QA,SA6QA,GAMA,IALA,mBACA,2BACA,aACA,WACA,oBACA,YACA,qBAEA,qBACA,kDAEA,KAzRA,WAyRA,WACA,mCACA,sCACA,oCACA,qBACA,sBACA,IACA,IACA,cACA,eACA,oBACA,CACA,sBACA,wBACA,KACA,KAEA,uBACA,qBACA,KACA,MAGA,oBACA,qBACA,eACA,eAEA,uBACA,iDACA,oCACA,wBACA,kBACA,oBACA,qBAMA,cACA,UAGA,mBAGA,oBACA,kBAEA,QAEA,MAEA,SA/UA,WAgVA,wB;;;;2DCxcA,8sBAAuxC,eAAG,G","file":"pages/center/ksp-image-cutter.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./ksp-image-cutter.vue?vue&type=template&id=2b7c7107&scoped=true&\"\nvar renderjs\nimport script from \"./ksp-image-cutter.vue?vue&type=script&lang=js&\"\nexport * from \"./ksp-image-cutter.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ksp-image-cutter.vue?vue&type=style&index=0&id=2b7c7107&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2b7c7107\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/center/ksp-image-cutter.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./ksp-image-cutter.vue?vue&type=template&id=2b7c7107&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./ksp-image-cutter.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./ksp-image-cutter.vue?vue&type=script&lang=js&\"","<template>\r\n<view v-show=\"url\" class=\"ksp-image-cutter\">\r\n\t<canvas class=\"left-top-canvas\" :style=\"{width: target.width + 'px', height: target.height + 'px'}\" canvas-id=\"target\"></canvas>\r\n\t<view class=\"body\">\r\n\r\n\t\t<image v-if=\"url\" class=\"image\" @load=\"imageLoad\" :style=\"{left: image.left + 'px', top: image.top + 'px', width: image.width + 'px', height: image.height + 'px'}\" :src=\"url\"></image>\r\n\t\r\n        <view v-if=\"mask.show\" class=\"mask\"></view>\r\n\t\t<view @touchstart=\"touchStart($event, 'plank')\" @touchmove=\"touchMove\" @touchend=\"touchEnd\" @touchcancel=\"touchCancel\"  class=\"plank\">\r\n\t\t\t<view class=\"frame\" @touchstart=\"touchStart($event, 'frame')\" @touchstart.stop.prevent=\"touchHandle\" :style=\"{left: frame.left + 'px', top: frame.top + 'px', width: frame.width + 'px', height: frame.height + 'px'}\">\r\n\t\t\t\t<canvas v-if=\"mask.show\" class=\"canvas\" :style=\"{width: frame.width + 'px', height: frame.height + 'px'}\" canvas-id=\"canvas\"></canvas>\r\n\t\t\t\t<view class=\"rect\"></view>\r\n\t\t\t\t<view class=\"line-one\"></view>\r\n\t\t\t\t<view class=\"line-two\"></view>\r\n\t\t\t\t<view class=\"line-three\"></view>\r\n\t\t\t\t<view class=\"line-four\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'left')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-left\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'right')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-right\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'top')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-top\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'bottom')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-bottom\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'left-top')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-left-top\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'left-bottom')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-left-bottom\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'right-top')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-right-top\"></view>\r\n\t\t\t\t<view @touchstart=\"touchStart($event, 'right-bottom')\" @touchstart.stop.prevent=\"touchHandle\" class=\"frame-right-bottom\"></view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n\t<view class=\"toolbar\">\r\n\t\t<button @tap=\"oncancle\" class=\"btn-cancel\">返回</button>\r\n\t\t<button @tap=\"onok\" class=\"btn-ok\">确定</button>\r\n\t</view>\r\n</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tprops: {\r\n\t\turl: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"\"\r\n\t\t},\r\n\t\tfixed: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 200\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 200\r\n\t\t},\r\n\t\tmaxWidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1024\r\n\t\t},\r\n\t\tmaxHeight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1024\r\n\t\t},\r\n\t\tblob: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmask: {\r\n\t\t\t\tshow: false\r\n\t\t\t},\r\n\t\t\tframe: {\r\n\t\t\t\tleft: 50,\r\n\t\t\t\ttop: 50,\r\n\t\t\t\twidth: this.width,\r\n\t\t\t\theight: this.height\r\n\t\t\t},\r\n\t\t\timage: {\r\n\t\t\t\tleft: 20,\r\n\t\t\t\ttop: 20,\r\n\t\t\t\twidth: 300,\r\n\t\t\t\theight: 400\r\n\t\t\t},\r\n\t\t\treal: {\r\n\t\t\t\twidth: 100,\r\n\t\t\t\theight: 100\r\n\t\t\t},\r\n\t\t\ttarget: {\r\n\t\t\t\twidth: this.width,\r\n\t\t\t\theight: this.height\r\n\t\t\t},\r\n\t\t\ttouches: [],\r\n\t\t\ttype: \"\",\r\n\t\t\tstart: {\r\n\t\t\t\tframe: {\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0\r\n\t\t\t\t},\r\n\t\t\t\timage: {\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\ttimeoutId: -1,\r\n\t\t\tcontext: null\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\t//#ifdef H5\r\n\t\tthis.$el.addEventListener(\"touchmove\", (ev) => {\r\n\t\t\tev.preventDefault();\r\n\t\t});\r\n\t\t// #endif\r\n\t\tthis.context = uni.createCanvasContext(\"canvas\", this);\r\n\t\tthis.targetContext = uni.createCanvasContext(\"target\", this);\r\n\t},\r\n\tmethods: {\r\n\t\timageLoad(ev) {\r\n\t\t\tthis.mask.show = true;\r\n\t\t\tthis.real.width = ev.detail.width;\r\n\t\t\tthis.real.height = ev.detail.height;\r\n\t\t\tthis.image.width = ev.detail.width;\r\n\t\t\tthis.image.height = ev.detail.height;\r\n\t\t\tthis.frame.width = this.width;\r\n\t\t\tthis.frame.height = this.height;\r\n\t\t\tif (!this.fixed) {\r\n\t\t\t\tthis.frame.width = this.image.width;\r\n\t\t\t\tthis.frame.height = this.image.height;\r\n\t\t\t}\r\n\t\t\tvar query = uni.createSelectorQuery().in(this);\r\n\t\t\tquery.select(\".body\").boundingClientRect((data) => {\r\n\t\t\t\tvar bw = data.width;\r\n\t\t\t\tvar bh = data.height;\r\n\t\t\t\tvar fw = this.frame.width;\r\n\t\t\t\tvar fh = this.frame.height;\r\n\t\t\t\tvar tw = bw * 0.8;\r\n\t\t\t\tvar th = bh * 0.8;\r\n\t\t\t\tvar sx = tw / fw;\r\n\t\t\t\tvar sy = th / fh;\r\n\t\t\t\tvar scale = sx;\r\n\t\t\t\tif (sx < sy) {\r\n\t\t\t\t\tscale = sy;\r\n\t\t\t\t}\r\n\t\t\t\ttw = fw * scale;\r\n\t\t\t\tth = fh * scale;\r\n\t\t\t\tvar tx = (bw - tw) / 2;\r\n\t\t\t\tvar ty = (bh - th) / 2;\r\n\t\t\t\tthis.frame.width = tw;\r\n\t\t\t\tthis.frame.height = th;\r\n\t\t\t\tthis.frame.left = tx;\r\n\t\t\t\tthis.frame.top = ty;\r\n\t\t\t\t\r\n\t\t\t\tvar iw = this.image.width;\r\n\t\t\t\tvar ih = this.image.height;\r\n\t\t\t\tsx = tw / iw;\r\n\t\t\t\tsy = th / ih;\r\n\t\t\t\tscale = sx;\r\n\t\t\t\tif (sx < sy) {\r\n\t\t\t\t\tscale = sy;\r\n\t\t\t\t}\r\n\t\t\t\tthis.image.width = iw * scale;\r\n\t\t\t\tthis.image.height = ih * scale;\r\n\t\t\t\tthis.image.left = (bw - this.image.width) / 2;\r\n\t\t\t\tthis.image.top = (bh - this.image.height) / 2;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.trimImage();\r\n\t\t\t\t}, 100);\r\n\t\t\t}).exec();\r\n\t\t},\r\n\t\ttouchHandle() {},\r\n\t\ttouchStart(ev, type) {\r\n\t\t\tthis.stopTime();\r\n\t\t\tthis.mask.show = false;\r\n\t\t\tif (this.touches.length == 0) {\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\tthis.start.frame.left = this.frame.left;\r\n\t\t\t\tthis.start.frame.top = this.frame.top;\r\n\t\t\t\tthis.start.frame.width = this.frame.width;\r\n\t\t\t\tthis.start.frame.height = this.frame.height;\r\n\t\t\t\tthis.start.image.left = this.image.left;\r\n\t\t\t\tthis.start.image.top = this.image.top;\r\n\t\t\t\tthis.start.image.width = this.image.width;\r\n\t\t\t\tthis.start.image.height = this.image.height;\r\n\t\t\t}\r\n\t\t\tvar touches = ev.changedTouches;\r\n\t\t\tfor(var i = 0; i < touches.length; i++) {\r\n\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t// this.touches[touch.identifier] = touch;\r\n\t\t\t\tthis.touches.push(touch);\r\n\t\t\t}\r\n\t\t},\r\n\t\ttouchMove(ev) {\r\n\t\t\tthis.stopTime();\r\n\t\t\tev.preventDefault();\r\n\t\t\tvar touches = ev.touches;\r\n\t\t\tif (this.touches.length == 1) {\r\n\t\t\t\tif (this.type == \"plank\" || this.type == \"frame\" || this.fixed) {\r\n\t\t\t\t\tthis.moveImage(this.touches[0], touches[0]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scaleFrame(this.touches[0], touches[0], this.type);\r\n\t\t\t\t}\r\n\t\t\t} else if (this.touches.length == 2 && touches.length == 2) {\r\n\t\t\t\tvar ta = this.touches[0];\r\n\t\t\t\tvar tb = this.touches[1];\r\n\t\t\t\tvar tc = touches[0];\r\n\t\t\t\tvar td = touches[1];\r\n\t\t\t\tif (ta.identifier != tc.identifier) {\r\n\t\t\t\t\tvar temp = tc;\r\n\t\t\t\t\ttc = td;\r\n\t\t\t\t\ttd = temp;\r\n\t\t\t\t}\r\n\t\t\t\tthis.scaleImage(ta, tb, tc, td);\r\n\t\t\t}\r\n\t\t},\r\n\t\ttouchEnd(ev) {\r\n\t\t\tthis.type = \"\";\r\n\t\t\tthis.touches = [];\r\n\t\t\tthis.startTime();\r\n\t\t},\r\n\t\ttouchCancel(ev) {\r\n\t\t\tthis.type = \"\";\r\n\t\t\tthis.touches = [];\r\n\t\t\tthis.startTime();\r\n\t\t},\r\n\t\tstartTime() {\r\n\t\t\tthis.stopTime();\r\n\t\t\tthis.timeoutId = setTimeout(() => {\r\n\t\t\t\tthis.trimImage();\r\n\t\t\t}, 800);\r\n\t\t},\r\n\t\tstopTime() {\r\n\t\t\tif (this.timeoutId >= 0) {\r\n\t\t\t\tclearTimeout(this.timeoutId);\r\n\t\t\t\tthis.timeoutId = -1;\r\n\t\t\t}\r\n\t\t},\r\n\t\ttrimImage() {\r\n\t\t\tthis.mask.show = true;\r\n\t\t\tvar query = uni.createSelectorQuery().in(this);\r\n\t\t\tquery.select(\".body\").boundingClientRect((data) => {\r\n\t\t\t\tvar bw = data.width;\r\n\t\t\t\tvar bh = data.height;\r\n\t\t\t\tvar fw = this.frame.width;\r\n\t\t\t\tvar fh = this.frame.height;\r\n\t\t\t\tvar tw = bw * 0.8;\r\n\t\t\t\tvar th = bh * 0.8;\r\n\t\t\t\tvar sx = tw / fw;\r\n\t\t\t\tvar sy = th / fh;\r\n\t\t\t\tvar scale = sx;\r\n\t\t\t\tif (sx > sy) {\r\n\t\t\t\t\tscale = sy;\r\n\t\t\t\t}\r\n\t\t\t\ttw = fw * scale;\r\n\t\t\t\tth = fh * scale;\r\n\t\t\t\tvar tx = (bw - tw) / 2;\r\n\t\t\t\tvar ty = (bh - th) / 2;\r\n\t\t\t\tvar ax = tx - this.frame.left + (this.frame.left - this.image.left) * (1 - scale);\r\n\t\t\t\tvar ay = ty - this.frame.top + (this.frame.top - this.image.top) * (1 - scale);\r\n\t\t\t\tthis.frame.width = tw;\r\n\t\t\t\tthis.frame.height = th;\r\n\t\t\t\tthis.frame.left = tx;\r\n\t\t\t\tthis.frame.top = ty;\r\n\t\t\t\tthis.image.width *= scale;\r\n\t\t\t\tthis.image.height *= scale;\r\n\t\t\t\tthis.image.left += ax;\r\n\t\t\t\tthis.image.top += ay;\r\n\t\t\t}).exec();\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tvar scale = this.image.width / this.real.width;\r\n\t\t\t\tvar x = (this.frame.left - this.image.left) / scale;\r\n\t\t\t\tvar y = (this.frame.top - this.image.top) / scale;\r\n\t\t\t\tvar width = this.frame.width / scale;\r\n\t\t\t\tvar height = this.frame.height / scale;\r\n\t\t\t\tthis.context.drawImage(this.url, x, y, width, height, 0, 0, this.frame.width, this.frame.height);\r\n\t\t\t\tthis.context.draw(false);\r\n\t\t\t}, 100);\r\n\t\t},\r\n\t\tmoveImage(ta, tb) {\r\n\t\t\tvar ax = tb.clientX - ta.clientX;\r\n\t\t\tvar ay = tb.clientY - ta.clientY;\r\n\t\t\tthis.image.left = this.start.image.left + ax;\r\n\t\t\tthis.image.top = this.start.image.top + ay;\r\n\t\t\tif (this.image.left > this.frame.left) {\r\n\t\t\t\tthis.image.left = this.frame.left;\r\n\t\t\t}\r\n\t\t\tif (this.image.top > this.frame.top) {\r\n\t\t\t\tthis.image.top = this.frame.top;\r\n\t\t\t}\r\n\t\t\tif (this.image.left + this.image.width < this.frame.left + this.frame.width) {\r\n\t\t\t\tthis.image.left = this.frame.left + this.frame.width - this.image.width; \r\n\t\t\t}\r\n\t\t\tif (this.image.top + this.image.height < this.frame.top + this.frame.height) {\r\n\t\t\t\tthis.image.top = this.frame.top + this.frame.height - this.image.height; \r\n\t\t\t}\r\n\t\t},\r\n\t\tscaleImage(ta, tb, tc, td) {\r\n\t\t\tvar x1 = ta.clientX;\r\n\t\t\tvar y1 = ta.clientY;\r\n\t\t\tvar x2 = tb.clientX;\r\n\t\t\tvar y2 = tb.clientY;\r\n\t\t\tvar x3 = tc.clientX;\r\n\t\t\tvar y3 = tc.clientY;\r\n\t\t\tvar x4 = td.clientX;\r\n\t\t\tvar y4 = td.clientY;\r\n\t\t\tvar ol = Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\r\n\t\t\tvar el = Math.sqrt((x3 - x4) * (x3 - x4) + (y3 - y4) * (y3 - y4));\r\n\t\t\tvar ocx = (x1 + x2) / 2;\r\n\t\t\tvar ocy = (y1 + y2) / 2;\r\n\t\t\tvar ecx = (x3 + x4) / 2;\r\n\t\t\tvar ecy = (y3 + y4) / 2;\r\n\t\t\tvar ax = ecx - ocx;\r\n\t\t\tvar ay = ecy - ocy;\r\n\t\t\tvar scale = el / ol;\r\n\t\t\tif (this.start.image.width * scale < this.frame.width) {\r\n\t\t\t\tscale = this.frame.width / this.start.image.width;\r\n\t\t\t}\r\n\t\t\tif (this.start.image.height * scale < this.frame.height) {\r\n\t\t\t\tscale = this.frame.height / this.start.image.height;\r\n\t\t\t}\r\n\t\t\tif (this.start.image.width * scale < this.frame.width) {\r\n\t\t\t\tscale = this.frame.width / this.start.image.width;\r\n\t\t\t}\r\n\t\t\tthis.image.left = this.start.image.left + ax - (ocx - this.start.image.left) * (scale - 1);\r\n\t\t\tthis.image.top = this.start.image.top + ay - (ocy - this.start.image.top) * (scale - 1);\r\n\t\t\tthis.image.width = this.start.image.width * scale;\r\n\t\t\tthis.image.height = this.start.image.height * scale;\r\n\t\t\tif (this.image.left > this.frame.left) {\r\n\t\t\t\tthis.image.left = this.frame.left;\r\n\t\t\t}\r\n\t\t\tif (this.image.top > this.frame.top) {\r\n\t\t\t\tthis.image.top = this.frame.top;\r\n\t\t\t}\r\n\t\t\tif (this.image.left + this.image.width < this.frame.left + this.frame.width) {\r\n\t\t\t\tthis.image.left = this.frame.left + this.frame.width - this.image.width; \r\n\t\t\t}\r\n\t\t\tif (this.image.top + this.image.height < this.frame.top + this.frame.height) {\r\n\t\t\t\tthis.image.top = this.frame.top + this.frame.height - this.image.height; \r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tscaleFrame(ta, tb, type) {\r\n\t\t\tvar ax = tb.clientX - ta.clientX;\r\n\t\t\tvar ay = tb.clientY - ta.clientY;\r\n\t\t\tvar x1 = this.start.frame.left;\r\n\t\t\tvar y1 = this.start.frame.top;\r\n\t\t\tvar x2 = this.start.frame.left + this.start.frame.width;\r\n\t\t\tvar y2 = this.start.frame.top + this.start.frame.height;\r\n\t\t\tif (type == \"left\") {\r\n\t\t\t\tx1 += ax;\r\n\t\t\t} else if (type == \"right\") {\r\n\t\t\t\tx2 += ax;\r\n\t\t\t} else if (type == \"top\") {\r\n\t\t\t\ty1 += ay;\r\n\t\t\t} else if (type == \"bottom\") {\r\n\t\t\t\ty2 += ay;\r\n\t\t\t} else if (type == \"left-top\") {\r\n\t\t\t\tx1 += ax;\r\n\t\t\t\ty1 += ay;\r\n\t\t\t} else if (type == \"left-bottom\") {\r\n\t\t\t\tx1 += ax;\r\n\t\t\t\ty2 += ay;\r\n\t\t\t} else if (type == \"right-top\") {\r\n\t\t\t\tx2 += ax;\r\n\t\t\t\ty1 += ay;\r\n\t\t\t} else if (type == \"right-bottom\") {\r\n\t\t\t\tx2 += ax;\r\n\t\t\t\ty2 += ay;\r\n\t\t\t}\r\n\t\t\tif (x1 < this.image.left) {\r\n\t\t\t\tx1 = this.image.left;\r\n\t\t\t}\r\n\t\t\tif (y1 < this.image.top) {\r\n\t\t\t\ty1 = this.image.top;\r\n\t\t\t}\r\n\t\t\tif (x2 > this.image.left + this.image.width) {\r\n\t\t\t\tx2 = this.image.left + this.image.width;\r\n\t\t\t}\r\n\t\t\tif (y2 > this.image.top + this.image.height) {\r\n\t\t\t\ty2 = this.image.top + this.image.height;\r\n\t\t\t}\r\n\t\t\tthis.frame.left = x1;\r\n\t\t\tthis.frame.top = y1;\r\n\t\t\tthis.frame.width = x2 - x1;\r\n\t\t\tthis.frame.height = y2 - y1;\r\n\t\t},\r\n\t\tparseBlob(base64) {\r\n\t\t\tvar arr = base64.split(',');\r\n\t\t\tvar mime = arr[0].match(/:(.*?);/)[1];\r\n\t\t\tvar bstr = atob(arr[1]);\r\n\t\t\tvar n = bstr.length;\r\n\t\t\tvar u8arr = new Uint8Array(n);\r\n\t\t\tfor(var i = 0; i < n; i++) {\r\n\t\t\t\tu8arr[i] = bstr.charCodeAt(i);\r\n\t\t\t}\r\n\t\t\tvar url = URL || webkitURL;\r\n\t\t\treturn url.createObjectURL(new Blob([u8arr], {type: mime}));\r\n\t\t},\r\n\t\tonok() {\r\n\t\t\tvar scale = this.image.width / this.real.width;\r\n\t\t\tvar x = (this.frame.left - this.image.left) / scale;\r\n\t\t\tvar y = (this.frame.top - this.image.top) / scale;\r\n\t\t\tvar width = this.frame.width / scale;\r\n\t\t\tvar height = this.frame.height / scale;\r\n\t\t\tvar tw = width;\r\n\t\t\tvar th = height;\r\n\t\t\tif (this.fixed) {\r\n\t\t\t\ttw = this.width / 2;\r\n\t\t\t\tth = this.height / 2;\r\n\t\t\t} else {\r\n\t\t\t\tif (tw > this.maxWidth / 2) {\r\n\t\t\t\t\tvar sc = this.maxWidth / 2 / tw;\r\n\t\t\t\t\ttw = tw * sc;\r\n\t\t\t\t\tth = th * sc;\r\n\t\t\t\t}\r\n\t\t\t\tif (th > this.maxHeight / 2) {\r\n\t\t\t\t\tvar sc = this.maxHeight / 2 / th;\r\n\t\t\t\t\tth = th * sc;\r\n\t\t\t\t\ttw = tw * sc;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.target.width = tw;\r\n\t\t\tthis.target.height = th;\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: \"正在裁剪\"\r\n\t\t\t});\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.targetContext.drawImage(this.url, x, y, width, height, 0, 0, tw, th);\r\n\t\t\t\tthis.targetContext.draw(false, () => {\r\n\t\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\t\tcanvasId: \"target\",\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tvar path = res.tempFilePath;\r\n\t\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\t\tif (this.blob) {\r\n\t\t\t\t\t\t\t\tpath = this.parseBlob(path);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\tthis.$emit(\"ok\", {\r\n\t\t\t\t\t\t\t\tpath: path\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (ev) => {\r\n\t\t\t\t\t\t\t// console.log(ev);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t});\r\n\t\t\t}, 100);\r\n\t\t},\r\n\t\toncancle() {\r\n\t\t\tthis.$emit(\"cancel\");\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.left-top-canvas{\r\n    position: absolute;\r\n    top: 1000px;\r\n}\r\n.ksp-image-cutter {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\ttop: 0;\r\n\tbottom: 0;\r\n\tz-index: 1000;\r\n}\r\n.toolbar {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 100upx;\r\n\tleft: 0upx;\r\n\tbottom: 0upx;\r\n\tbox-sizing: border-box;\r\n\tborder-bottom: 1px solid #C0C0C0;\r\n\tbackground: #F8F8F8;\r\n}\r\n.btn-cancel {\r\n\tposition: absolute;\r\n\tleft: 100upx;\r\n\ttop: 12upx;\r\n\tfont-size: 30upx;\r\n\tline-height: 30upx;\r\n\tpadding: 20upx;\r\n\tcolor: #333333;\r\n}\r\n.btn-ok {\r\n\tposition: absolute;\r\n\tright: 100upx;\r\n\ttop: 12upx;\r\n\tfont-size: 30upx;\r\n\tline-height: 30upx;\r\n\tpadding: 20upx;\r\n\tcolor: #333333;\r\n}\r\n.body {\r\n\tposition: absolute;\r\n\tleft: 0upx;\r\n\tright: 0upx;\r\n\ttop: 0upx;\r\n\tbottom: 100upx;\r\n\tbackground: black;\r\n\toverflow: hidden;\r\n}\r\n.mask {\r\n\tposition: absolute;\r\n\tleft: 0upx;\r\n\tright: 0upx;\r\n\ttop: 0upx;\r\n\tbottom: 0upx;\r\n\tbackground: black;\r\n\topacity: 0.4;\r\n}\r\n.plank {\r\n\tposition: absolute;\r\n\tleft: 0upx;\r\n\tright: 0upx;\r\n\ttop: 0upx;\r\n\tbottom: 0upx;\r\n}\r\n.image {\r\n\tposition: absolute;\r\n}\r\n.frame {\r\n\tposition: absolute;\r\n}\r\n.canvas {\r\n\tposition: absolute;\r\n\tdisplay: block;\r\n\tleft: 0px;\r\n\ttop: 0px;\r\n}\r\n.rect {\r\n\tposition: absolute;\r\n\tleft: -2px;\r\n\ttop: -2px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tborder: 2px solid white;\r\n}\r\n.line-one {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 1px;\r\n\tbackground: white;\r\n\tleft: 0;\r\n\ttop: 33.3%;\r\n}\r\n.line-two {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 1px;\r\n\tbackground: white;\r\n\tleft: 0;\r\n\ttop: 66.7%;\r\n}\r\n.line-three {\r\n\tposition: absolute;\r\n\twidth: 1px;\r\n\theight: 100%;\r\n\tbackground: white;\r\n\ttop: 0;\r\n\tleft: 33.3%;\r\n}\r\n.line-four {\r\n\tposition: absolute;\r\n\twidth: 1px;\r\n\theight: 100%;\r\n\tbackground: white;\r\n\ttop: 0;\r\n\tleft: 66.7%;\r\n}\r\n.frame-left {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 8px;\r\n\tleft: -4px;\r\n\ttop: 0;\r\n}\r\n.frame-right {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 8px;\r\n\tright: -4px;\r\n\ttop: 0;\r\n}\r\n.frame-top {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 8px;\r\n\ttop: -4px;\r\n\tleft: 0;\r\n}\r\n.frame-bottom {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 8px;\r\n\tbottom: -4px;\r\n\tleft: 0;\r\n}\r\n.frame-left-top {\r\n\tposition: absolute;\r\n\twidth: 20px;\r\n\theight: 20px;\r\n\tleft: -6px;\r\n\ttop: -6px;\r\n\tborder-left: 4px solid red;\r\n\tborder-top: 4px solid red;\r\n}\r\n.frame-left-bottom {\r\n\tposition: absolute;\r\n\twidth: 20px;\r\n\theight: 20px;\r\n\tleft: -6px;\r\n\tbottom: -6px;\r\n\tborder-left: 4px solid red;\r\n\tborder-bottom: 4px solid red;\r\n}\r\n.frame-right-top {\r\n\tposition: absolute;\r\n\twidth: 20px;\r\n\theight: 20px;\r\n\tright: -6px;\r\n\ttop: -6px;\r\n\tborder-right: 4px solid red;\r\n\tborder-top: 4px solid red;\r\n}\r\n.frame-right-bottom {\r\n\tposition: absolute;\r\n\twidth: 20px;\r\n\theight: 20px;\r\n\tright: -6px;\r\n\tbottom: -6px;\r\n\tborder-right: 4px solid red;\r\n\tborder-bottom: 4px solid red;\r\n}\r\n</style>\r\n","import mod from \"-!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./ksp-image-cutter.vue?vue&type=style&index=0&id=2b7c7107&scoped=true&lang=css&\"; export default mod; export * from \"-!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\longwei\\\\Downloads\\\\HBuilderX.2.9.8.20201110\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./ksp-image-cutter.vue?vue&type=style&index=0&id=2b7c7107&scoped=true&lang=css&\""],"sourceRoot":""}